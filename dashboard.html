<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instructify | Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="shortcut icon" href="logo.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
  
</head>
<body class="dashboard">
  <nav class="navbar">
    <div class="logo" href="#">Instructify<sup>Â®</sup></div>
    <div class="nav-links" id="nav-links">
      <a href="index.html">Home</a>
      <a href="courses.html">Courses</a>
      <div class="dropdown">
        <button class="drop-btn" aria-expanded="false" type="button">Pages</button>
        <div class="dropdown-menu">
          <a href="book.html">Books</a>
          <a href="novel.html">Novels</a>
          <a href="dashboard.html">Dashboard</a>
          <a href="admin.html">Admin</a>
          <a href="blog.html">Blog</a>
        </div>
      </div>
      <a href="about.html">About</a>
      <a href="login.html">Login</a>     
      <a href="contact.html">Contact</a>
      <button id="dark-toggle" class="dark-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
    </div>
    <div class="nav-actions">
      <button id="hamburger" class="hamburger" aria-label="Toggle menu" aria-controls="nav-links" aria-expanded="false">
        <span class="bar bar1"></span>
        <span class="bar bar2"></span>
        <span class="bar bar3"></span>
      </button>
      <button id="dark-toggle" class="dark-toggle" aria-label="Toggle dark mode" title="Toggle theme">
        <i class="bi bi-moon-fill" aria-hidden="true"></i>
      </button>
    </div>
  </nav>
  
  <div class="dashboard-container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <p>.</p><br>
      <h2><a href="index.html">Dashboard Panel</a> </h2>
      <ul>
        <li><a href="student.html">Students</a></li>
        <li><a href="teacher.html">Teachers</a></li>
        <li><a href="admin.html">Admin</a></li>

      </ul>
    </aside>
    <div><img src="blog-1.jpg" alt="dashboard"></div>
  </div>  
    <!-- MAIN CONTENT -->
  <div>
  <h1 style="margin-bottom:20px;">My Learning Dashboard</h1>

  <div id="dashboard" class="dashboard-grid"></div>
    <div class="course-progress">
  <div class="progress-label">
    Progress: <span id="progress-percent">0%</span>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill"></div>
  </div>
</div>
  <button>
    <a id="download-cert" style="display:none; text-decoration:none; color:white;">Download Certificate</a>
  </button>
  </div>

  <footer class="footer">
  <div class="footer-container">
    <!-- Logo & Description -->
    <div class="footer-left">
      <img src="logo.png" alt="Instructify Logo" class="footer-logo">
      <p>Instructify helps learners build practical skills through modern, accessible online courses.</p>
    </div>

    
    <div class="footer-center">
      <h4>Quick Links</h4>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </div>

    
    <div class="footer-right">
      <h4>Connect</h4>
      <div class="social-icons">
        <a href="#"><i class="bi bi-twitter"></i></a>
        <a href="#"><i class="bi bi-facebook"></i></a>
        <a href="#"><i class="bi bi-linkedin"></i></a>
      </div>
      <p>ðŸ“§ <a href="mailto:info@instructify.com">info@instructify.com</a></p>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 Instructify. All rights reserved.</p>
  </div>
</footer>
  <script src="script.js"></script>
  <script src="auth.js"></script>
  <script src="progress.js"></script>
  <script src="course-data-bs.js"></script>
  <script src="dashboard.js"></script>
  <script>
    
  requireAuth();
  updateAuthUI();
</script>
<script>
(function () {
  const user = localStorage.getItem('currentUser');

  if (!user) {
    const currentPage = window.location.pathname.split('/').pop();
    window.location.href = `login.html?next=${currentPage}`;
  }
})();

</script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function updateCourseProgress(courseId, totalTopics) {
  const progress = getUserProgress();
  const course = progress?.courses[courseId];

  if (!course) return;

  const percent = Math.round(
    (course.completedTopics.length / totalTopics) * 100
  );

  document.getElementById("progress-fill").style.width = percent + "%";
  document.getElementById("progress-percent").textContent = percent + "%";
}

function showCertificateButton(courseId, totalTopics) {
  const progress = getUserProgress();
  const course = progress?.courses[courseId];

  if (
    course &&
    course.completedTopics.length === totalTopics &&
    course.completed
  ) {
    document.getElementById("download-cert").style.display = "inline-block";
  }
}
function generatePDFCertificate(courseTitle) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("landscape");

  const user = getCurrentUser();
  const date = new Date().toLocaleDateString();

  // Border
  doc.setLineWidth(2);
  doc.rect(10, 10, 277, 190);

  // Title
  doc.setFontSize(26);
  doc.text("Certificate of Completion", 148, 40, { align: "center" });

  // Content
  doc.setFontSize(16);
  doc.text("This certifies that", 148, 65, { align: "center" });

  doc.setFontSize(22);
  doc.setFont("helvetica", "bold");
  doc.text(user.fullName, 148, 85, { align: "center" });

  doc.setFont("helvetica", "normal");
  doc.setFontSize(16);
  doc.text("has successfully completed the course", 148, 105, {
    align: "center"
  });

  doc.setFontSize(20);
  doc.text(courseTitle, 148, 125, { align: "center" });

  // Footer
  doc.setFontSize(14);
  doc.text(`Issued by Instructify`, 40, 160);
  doc.text(`Date: ${date}`, 220, 160);

  // Signature line
  doc.line(40, 145, 120, 145);
  doc.text("Authorized Signature", 40, 152);

  doc.save(`${courseTitle}-Certificate.pdf`);
}


const dashboard = document.getElementById("dashboard");
const progress = getUserProgress();

// Loop through all courses
courseData.forEach(course => {
  const courseProgress = progress.courses[course.id];
  const completedTopics = courseProgress?.completedTopics.length || 0;
  const totalTopics = course.topics.length;

  const percent = Math.round((completedTopics / totalTopics) * 100) || 0;

  const card = document.createElement("div");
  card.className = "course-card";

  card.innerHTML = `
    <div class="course-title">${course.title}</div>

    <div class="progress-bar">
      <div class="progress-fill" style="width:${percent}%"></div>
    </div>

    <div class="progress-text">${percent}% completed</div>

    <div class="course-actions">
      <button class="resume-btn">Resume</button>
      ${percent === 100 ? `<button class="cert-btn">Certificate</button>` : ""}
    </div>
  `;

  // Resume logic
  card.querySelector(".resume-btn").onclick = () => {
    const last = courseProgress?.lastTopic || course.topics[0].id;
    window.location.href = `course.html?course=${course.id}&topic=${last}`;
  };

  // Certificate logic
  if (percent === 100) {
    card.querySelector(".cert-btn").onclick = () => {
      generatePDFCertificate(course.title);
    };
  }

  dashboard.appendChild(card);
});


  </script>
</body>
</html>